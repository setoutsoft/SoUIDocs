<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="C++ 快速设计界面库"><meta name=author content="SoUI Team"><link href=https://X.org/Development/22/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.1.3"><title>4.22 在 SOUI 中使用异步通知 - SoUI3官方文档</title><link rel=stylesheet href=../../assets/stylesheets/main.edf004c2.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.e6a45f82.min.css><meta name=theme-color content=#ffffff><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans:300,400,400i,700%7CSource+Code+Pro&display=fallback"><style>:root{--md-text-font:"Noto Sans";--md-code-font:"Source Code Pro"}</style><link rel=stylesheet href=../../static/css/extra.css><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=preference data-md-color-primary=white data-md-color-accent=blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#422-soui class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../.. title=SoUI3官方文档 class="md-header__button md-logo" aria-label=SoUI3官方文档 data-md-component=logo> <img src=../../static/img/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> SoUI3官方文档 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 4.22 在 SOUI 中使用异步通知 </span> </div> </div> </div> <div class=md-header__option> <div class=md-select> <button class="md-header__button md-icon" aria-label=选择当前语言> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24z"/></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=/ hreflang class=md-select__link> 中文 </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/2926295173/SoUIDocs/ title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> 2926295173/SoUIDocs </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Start </a> </li> <li class=md-tabs__item> <a href=../../Overview/10/ class=md-tabs__link> 概述 </a> </li> <li class=md-tabs__item> <a href=../../BuildSoUI/build/ class=md-tabs__link> 编译 </a> </li> <li class=md-tabs__item> <a href=../../Create/31/ class=md-tabs__link> 创建 </a> </li> <li class=md-tabs__item> <a href=../0/ class="md-tabs__link md-tabs__link--active"> 开发 </a> </li> <li class=md-tabs__item> <a href=../../Control/Summary/ class=md-tabs__link> 控件 </a> </li> <li class=md-tabs__item> <a href=../../Ask/Summary/ class=md-tabs__link> 提问 </a> </li> <li class=md-tabs__item> <a href=../../Others/1/ class=md-tabs__link> 其他 </a> </li> <li class=md-tabs__item> <a href=../../updatelog/ class=md-tabs__link> 更新 </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=SoUI3官方文档 class="md-nav__button md-logo" aria-label=SoUI3官方文档 data-md-component=logo> <img src=../../static/img/logo.png alt=logo> </a> SoUI3官方文档 </label> <div class=md-nav__source> <a href=https://github.com/2926295173/SoUIDocs/ title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> 2926295173/SoUIDocs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Start <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Start data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Start </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> 简介 </a> </li> <li class=md-nav__item> <a href=../../discussion/ class=md-nav__link> 讨论交流与问题反馈 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> 概述 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=概述 data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 概述 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Overview/10/ class=md-nav__link> 1、概述 </a> </li> <li class=md-nav__item> <a href=../../Overview/11/ class=md-nav__link> 1.1 SOUI 是什么？ </a> </li> <li class=md-nav__item> <a href=../../Overview/12/ class=md-nav__link> 1.2 SOUI 相对于 DuiEngine 的改进 </a> </li> <li class=md-nav__item> <a href=../../Overview/13/ class=md-nav__link> 1.3 SOUI 模块结构 </a> </li> <li class=md-nav__item> <a href=../../Overview/14/ class=md-nav__link> 1.4 模块结构图及框架图 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> 编译 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=编译 data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 编译 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../BuildSoUI/build/ class=md-nav__link> 2、SOUI 的编译 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> 创建 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=创建 data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 创建 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Create/31/ class=md-nav__link> 3、开始使用 SOUI </a> </li> <li class=md-nav__item> <a href=../../Create/32/ class=md-nav__link> 3、开始使用 SOUI </a> </li> <li class=md-nav__item> <a href=../../Create/33/ class=md-nav__link> 3、开始使用 SOUI </a> </li> <li class=md-nav__item> <a href=../../Create/34/ class=md-nav__link> 3、开始使用 SOUI </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> 开发 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=开发 data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../0/ class=md-nav__link> 4、SOUI 开发说明 </a> </li> <li class=md-nav__item> <a href=../1/ class=md-nav__link> 4.1 xml 资源文件定义 </a> </li> <li class=md-nav__item> <a href=../2/ class=md-nav__link> 4.2 系统资源管理 </a> </li> <li class=md-nav__item> <a href=../3/ class=md-nav__link> 4.3 应用程序中资源的组织 </a> </li> <li class=md-nav__item> <a href=../4/ class=md-nav__link> 4.4 在 SOUI 中用九宫格拉伸方式显示一个图片资源 </a> </li> <li class=md-nav__item> <a href=../5.md class=md-nav__link> None </a> </li> <li class=md-nav__item> <a href=../6.md class=md-nav__link> None </a> </li> <li class=md-nav__item> <a href=../7/ class=md-nav__link> 4.7 在 SOUI 中使用有窗口句柄的子窗口 </a> </li> <li class=md-nav__item> <a href=../8/ class=md-nav__link> 4.8 SOUI 中控件事件的响应 </a> </li> <li class=md-nav__item> <a href=../9/ class=md-nav__link> 4.9 SOUI 多语言翻译机制 </a> </li> <li class=md-nav__item> <a href=../10/ class=md-nav__link> 4.10 自定义控件 </a> </li> <li class=md-nav__item> <a href=../11/ class=md-nav__link> 4.11 在 SOUI 中使用定时器 </a> </li> <li class=md-nav__item> <a href=../12/ class=md-nav__link> 4.12 在 SOUI 中消息通讯 </a> </li> <li class=md-nav__item> <a href=../13/ class=md-nav__link> 4.13 使用窗口的 cache 属性加速 SOUI 的渲染 </a> </li> <li class=md-nav__item> <a href=../14/ class=md-nav__link> 4.14 在 SOUI 中实现 PreTranslateMessage </a> </li> <li class=md-nav__item> <a href=../15/ class=md-nav__link> 4.15 提高 SOUI 应用程序渲染性能的三种武器 </a> </li> <li class=md-nav__item> <a href=../16/ class=md-nav__link> 4.16 在 SOUI 中使用分层窗口 </a> </li> <li class=md-nav__item> <a href=../17/ class=md-nav__link> 4.17 在 SOUI 中的控件注册机制 </a> </li> <li class=md-nav__item> <a href=../18/ class=md-nav__link> 4.18 在 SOUI 中使用代码向窗口中插入子窗口 </a> </li> <li class=md-nav__item> <a href=../19/ class=md-nav__link> 4.19 在 SOUI 中使用 LUA 脚本开发界面 </a> </li> <li class=md-nav__item> <a href=../20/ class=md-nav__link> 4.20 导出 SOUI 对象到 LUA 脚本 </a> </li> <li class=md-nav__item> <a href=../21/ class=md-nav__link> 4.21 在 SOUI 中做事件分发处理 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> 4.22 在 SOUI 中使用异步通知 </a> </li> <li class=md-nav__item> <a href=../23/ class=md-nav__link> 4.23 在 SOUI2.0 中像 android 一样使用资源 </a> </li> <li class=md-nav__item> <a href=../24/ class=md-nav__link> 4.24 两个 SOUI 新控件 ---- SListView 和 SComboView（借用 Andorid 的设计） </a> </li> <li class=md-nav__item> <a href=../25/ class=md-nav__link> 4.25 在 SOUI 中控件属性查询方法 </a> </li> <li class=md-nav__item> <a href=../26/ class=md-nav__link> 4.26 使用 SOUI 的 SMCListView 控件 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> 控件 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=控件 data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 控件 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Control/Summary/ class=md-nav__link> 5、控件说明（SOUI） </a> </li> <li class=md-nav__item> <a href=../../Control/51/ class=md-nav__link> 5.1 SWindow 类 </a> </li> <li class=md-nav__item> <a href=../../Control/52/ class=md-nav__link> 5.2 SwndStyle 类 </a> </li> <li class=md-nav__item> <a href=../../Control/53/ class=md-nav__link> 5.3 SHostWndAttr 类 </a> </li> <li class=md-nav__item> <a href=../../Control/54/ class=md-nav__link> 5.4 静态文本控件 </a> </li> <li class=md-nav__item> <a href=../../Control/55/ class=md-nav__link> 5.5 超链接控件 </a> </li> <li class=md-nav__item> <a href=../../Control/56/ class=md-nav__link> 5.6 按钮/图片按钮控件 </a> </li> <li class=md-nav__item> <a href=../../Control/57/ class=md-nav__link> 5.7 图片控件 </a> </li> <li class=md-nav__item> <a href=../../Control/58/ class=md-nav__link> 5.8 动画图片窗口控件 </a> </li> <li class=md-nav__item> <a href=../../Control/59/ class=md-nav__link> 5.9 线条控件 </a> </li> <li class=md-nav__item> <a href=../../Control/510/ class=md-nav__link> 5.10 复选框控件 </a> </li> <li class=md-nav__item> <a href=../../Control/511/ class=md-nav__link> 5.11 图标控件 </a> </li> <li class=md-nav__item> <a href=../../Control/512/ class=md-nav__link> 5.12 单选框控件 </a> </li> <li class=md-nav__item> <a href=../../Control/513/ class=md-nav__link> 5.13 Toggle 控件 </a> </li> <li class=md-nav__item> <a href=../../Control/514/ class=md-nav__link> 5.14 组控件 </a> </li> <li class=md-nav__item> <a href=../../Control/515/ class=md-nav__link> 5.15 可输入 CommboBox 控件 </a> </li> <li class=md-nav__item> <a href=../../Control/516/ class=md-nav__link> 5.16 日历控件 </a> </li> <li class=md-nav__item> <a href=../../Control/517/ class=md-nav__link> 5.17 标签控件 </a> </li> <li class=md-nav__item> <a href=../../Control/518/ class=md-nav__link> 5.18 富文本编辑框控件 </a> </li> <li class=md-nav__item> <a href=../../Control/519/ class=md-nav__link> 5.19 简单 edit 控件 </a> </li> <li class=md-nav__item> <a href=../../Control/520/ class=md-nav__link> 5.20 表头控件 </a> </li> <li class=md-nav__item> <a href=../../Control/521/ class=md-nav__link> 5.21 热键控件 </a> </li> <li class=md-nav__item> <a href=../../Control/522/ class=md-nav__link> 5.22 列表框控件 </a> </li> <li class=md-nav__item> <a href=../../Control/523/ class=md-nav__link> 5.23 列表控件 </a> </li> <li class=md-nav__item> <a href=../../Control/524/ class=md-nav__link> 5.24 滚动条控件 </a> </li> <li class=md-nav__item> <a href=../../Control/525/ class=md-nav__link> 5.25 滑块工具条控件 </a> </li> <li class=md-nav__item> <a href=../../Control/526/ class=md-nav__link> 5.26 分割窗口控件 </a> </li> <li class=md-nav__item> <a href=../../Control/527/ class=md-nav__link> 5.27 分割窗口控件 </a> </li> <li class=md-nav__item> <a href=../../Control/528/ class=md-nav__link> 5.28 Tab 标签页面控件 </a> </li> <li class=md-nav__item> <a href=../../Control/529/ class=md-nav__link> 5.29 Tab 控件 </a> </li> <li class=md-nav__item> <a href=../../Control/530/ class=md-nav__link> 5.30 树控件 </a> </li> <li class=md-nav__item> <a href=../../Control/531/ class=md-nav__link> 5.31 按钮控件 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> 提问 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=提问 data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> 提问 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Ask/Summary/ class=md-nav__link> 6、常见问题 </a> </li> <li class=md-nav__item> <a href=../../Ask/1/ class=md-nav__link> 6.1 模块 utilities 为什么要用 DLL 编译？ </a> </li> <li class=md-nav__item> <a href=../../Ask/2/ class=md-nav__link> 6.2 为什么在 soui 中加载 JPG 文件失败？ </a> </li> <li class=md-nav__item> <a href=../../Ask/3/ class=md-nav__link> 6.3 不注册 COM 在 Richedit 中使 OLE 支持复制粘贴 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> 其他 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=其他 data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Others/1/ class=md-nav__link> 7.1 谈谈 SOUI 与 WTL </a> </li> <li class=md-nav__item> <a href=../../Others/2/ class=md-nav__link> 7.2 在 SOUI 中非半透明窗口如何实现圆角窗口？ </a> </li> <li class=md-nav__item> <a href=../../Others/3/ class=md-nav__link> 7.4 一种高效的可变行高列表行定位算法 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> 更新 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=更新 data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> 更新 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../updatelog/ class=md-nav__link> SOUI 更新到 2.0 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/2926295173/SoUIDocs/blob/main/docs/zh/docs/Development/22.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=422-soui>4.22 在 SOUI 中使用异步通知<a class=headerlink href=#422-soui title="Permanent link">&para;</a></h1> <p>异步通知是客户端开发中常见的需求，比如在一个网络处理线程中要通知 UI 线程更新等 等。 通常在 Windows 编程中，为了方便，我们一般会向 UI 线程的窗口句柄 Post/Send 一个 窗口消息从而达到将非 UI 线程的事件切换到 UI 线程处理的目的。 在 SOUI 引入通知中心以前要在 SOUI 中处理非 UI 线程事件我也推荐用上面的方法。 使用窗口消息至少有以下两个不足： 1、需要在线程中持有一个窗口句柄。 2、发出的消息只能在该窗口句柄的消息处理函数里处理。 SNotifyCenter 最新的 SOUI 引入了一个新的单例对象：SNotifyCenter，专门用来处理这类问题。 新的 SNotifyCenter 解决了窗口消息存在的上面的两个问题： 1、通过使用全局单例，SNotifyCenter 可以在代码任意位置获取它的指针（前提当然是要 在它的生命周期内）； 2、使用 SNotifyCenter 产生的通知采用 SOUI 的事件系统来派发，通过结合 SOUI 的事 件订阅系统，用户可以在任意位置处理发出的事件。 在介绍如何使用 SNotifyCenter 前，先看一下 NotifyCenter.h 的代码：</p> <div class=highlight><pre><span></span><code><span class=cp>#pragma once</span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;core/SSingleton.h&gt;</span><span class=cp></span>
<span class=k>namespace</span><span class=w> </span><span class=nn>SOUI</span><span class=w></span>
<span class=p>{</span><span class=w></span>
<span class=w> </span><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span><span class=w></span>
<span class=w> </span><span class=k>class</span> <span class=nc>TAutoEventMapReg</span><span class=w></span>
<span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w> </span><span class=k>typedef</span><span class=w> </span><span class=n>TAutoEventMapReg</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>_thisClass</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=k>public</span><span class=o>:</span><span class=w></span>
<span class=w> </span><span class=n>TAutoEventMapReg</span><span class=p>()</span><span class=w></span>
<span class=w> </span><span class=p>{</span><span class=w></span>

<span class=n>SNotifyCenter</span><span class=o>::</span><span class=n>getSingleton</span><span class=p>().</span><span class=n>RegisterEventMap</span><span class=p>(</span><span class=n>Subscriber</span><span class=p>(</span><span class=o>&amp;</span><span class=n>_thisClass</span><span class=o>::</span><span class=n>OnEve</span><span class=w></span>
<span class=n>nt</span><span class=p>,</span><span class=k>this</span><span class=p>));</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=o>~</span><span class=n>TAutoEventMapReg</span><span class=p>()</span><span class=w></span>
<span class=w> </span><span class=p>{</span><span class=w></span>

<span class=n>SNotifyCenter</span><span class=o>::</span><span class=n>getSingleton</span><span class=p>().</span><span class=n>UnregisterEventMap</span><span class=p>(</span><span class=n>Subscriber</span><span class=p>(</span><span class=o>&amp;</span><span class=n>_thisClass</span><span class=o>::</span><span class=n>OnE</span><span class=w></span>
<span class=n>vent</span><span class=p>,</span><span class=k>this</span><span class=p>));</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=k>protected</span><span class=o>:</span><span class=w></span>
<span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>OnEvent</span><span class=p>(</span><span class=n>EventArgs</span><span class=w> </span><span class=o>*</span><span class=n>e</span><span class=p>){</span><span class=w></span>
<span class=n>T</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>pThis</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>static_cast</span><span class=o>&lt;</span><span class=n>T</span><span class=o>*&gt;</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=k>return</span><span class=w> </span><span class=o>!!</span><span class=n>pThis</span><span class=o>-&gt;</span><span class=n>_HandleEvent</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=p>};</span><span class=w></span>
<span class=w> </span><span class=k>class</span> <span class=nc>SOUI_EXP</span><span class=w> </span><span class=nl>SNotifyCenter</span> <span class=p>:</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=n>SSingleton</span><span class=o>&lt;</span><span class=n>SNotifyCenter</span><span class=o>&gt;</span><span class=w></span>
<span class=w> </span><span class=p>,</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=n>SEventSet</span><span class=w></span>
<span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w> </span><span class=k>public</span><span class=o>:</span><span class=w></span>
<span class=w> </span><span class=n>SNotifyCenter</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=o>~</span><span class=n>SNotifyCenter</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=cm>/**</span>
<span class=cm> * FireEventSync</span>
<span class=cm> * @brief 触发一个同步通知事件</span>
<span class=cm> * @param EventArgs *e -- 事件对象</span>
<span class=cm> * @return </span>
<span class=cm> *</span>
<span class=cm> * Describe 只能在 UI 线程中调用</span>
<span class=cm> */</span><span class=w></span>
<span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>FireEventSync</span><span class=p>(</span><span class=n>EventArgs</span><span class=w> </span><span class=o>*</span><span class=n>e</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=cm>/**</span>
<span class=cm> * FireEventAsync</span>
<span class=cm> * @brief 触发一个异步通知事件</span>
<span class=cm> * @param EventArgs *e -- 事件对象</span>
<span class=cm> * @return </span>
<span class=cm> *</span>
<span class=cm> * Describe 可以在非 UI 线程中调用，EventArgs *e 必须是从堆上分配的内存，调用后</span>
<span class=cm>使用 Release 释放引用计数</span>
<span class=cm> */</span><span class=w></span>
<span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>FireEventAsync</span><span class=p>(</span><span class=n>EventArgs</span><span class=w> </span><span class=o>*</span><span class=n>e</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=cm>/**</span>
<span class=cm> * RegisterEventMap</span>
<span class=cm> * @brief 注册一个处理通知的对象</span>
<span class=cm> * @param const ISlotFunctor &amp;slot -- 事件处理对象</span>
<span class=cm> * @return </span>
<span class=cm> *</span>
<span class=cm> * Describe </span>
<span class=cm> */</span><span class=w></span>
<span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=nf>RegisterEventMap</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>ISlotFunctor</span><span class=w> </span><span class=o>&amp;</span><span class=n>slot</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=cm>/**</span>
<span class=cm> * RegisterEventMap</span>
<span class=cm> * @brief 注销一个处理通知的对象</span>
<span class=cm> * @param const ISlotFunctor &amp;slot -- 事件处理对象</span>
<span class=cm> * @return</span>
<span class=cm> *</span>
<span class=cm> * Describe </span>
<span class=cm> */</span><span class=w></span>
<span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=nf>UnregisterEventMap</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>ISlotFunctor</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>slot</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=k>protected</span><span class=o>:</span><span class=w></span>
<span class=w> </span><span class=kt>void</span><span class=w> </span><span class=n>OnFireEvent</span><span class=p>(</span><span class=n>EventArgs</span><span class=w> </span><span class=o>*</span><span class=n>e</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>ExecutePendingEvents</span><span class=p>();</span><span class=w></span>
<span class=w> </span><span class=k>static</span><span class=w> </span><span class=n>VOID</span><span class=w> </span><span class=n>CALLBACK</span><span class=w> </span><span class=n>OnTimer</span><span class=p>(</span><span class=w> </span><span class=n>HWND</span><span class=w> </span><span class=n>hwnd</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=n>UINT</span><span class=w> </span><span class=n>uMsg</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=n>UINT_PTR</span><span class=w> </span><span class=n>idEvent</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=n>DWORD</span><span class=w> </span><span class=n>dwTime</span><span class=w></span>
<span class=w> </span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=n>SCriticalSection</span><span class=w> </span><span class=n>m_cs</span><span class=p>;</span><span class=w> </span><span class=c1>//线程同步对象</span>
<span class=w> </span><span class=n>SList</span><span class=o>&lt;</span><span class=n>EventArgs</span><span class=o>*&gt;</span><span class=w> </span><span class=o>*</span><span class=n>m_evtPending</span><span class=p>;</span><span class=c1>//挂起的等待执行的事件</span>
<span class=w> </span><span class=n>DWORD</span><span class=w> </span><span class=n>m_dwMainTrdID</span><span class=p>;</span><span class=c1>//主线程 ID </span>
<span class=w> </span><span class=n>UINT_PTR</span><span class=w> </span><span class=n>m_timerID</span><span class=p>;</span><span class=w> </span><span class=c1>//定时器 ID，用来执行异步事件</span>
<span class=w> </span><span class=n>SList</span><span class=o>&lt;</span><span class=n>ISlotFunctor</span><span class=o>*&gt;</span><span class=w> </span><span class=n>m_evtHandlerMap</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>};</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <p>在这个文件中提供了两个类，一个就是 SNotifyCenter，另一个是 <code>TAutoEventMapReg&lt;T&gt;</code>。 可以看到 SNotifyCenter 中除构造外只有 4 个 public 方法: FireEventSync, FireEventAsync 用来触发事件。 RegisterEventMap，UnregisterEventMap 则用来提供事件处理订阅。 如何使用 SNotifyCenter? 1、在 main 中实例化 SNotifyCenter。（不明白可以参考 demo) 2、定义需要通过通知中心分发的事件类型，首先定义事件，然后向通知中心注册，参见 下面代码：</p> <div class=highlight><pre><span></span><code><span class=kt>void</span><span class=w> </span><span class=nf>CMainDlg::OnBtnStartNotifyThread</span><span class=p>()</span><span class=w></span>
<span class=p>{</span><span class=w></span>
<span class=w> </span><span class=k>if</span><span class=p>(</span><span class=n>IsRunning</span><span class=p>())</span><span class=w> </span><span class=k>return</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=n>SNotifyCenter</span><span class=o>::</span><span class=n>getSingleton</span><span class=p>().</span><span class=n>addEvent</span><span class=p>(</span><span class=n>EVENTID</span><span class=p>(</span><span class=n>EventThreadStart</span><span class=p>));</span><span class=w></span>
<span class=w> </span><span class=n>SNotifyCenter</span><span class=o>::</span><span class=n>getSingleton</span><span class=p>().</span><span class=n>addEvent</span><span class=p>(</span><span class=n>EVENTID</span><span class=p>(</span><span class=n>EventThreadStop</span><span class=p>));</span><span class=w></span>
<span class=w> </span><span class=n>SNotifyCenter</span><span class=o>::</span><span class=n>getSingleton</span><span class=p>().</span><span class=n>addEvent</span><span class=p>(</span><span class=n>EVENTID</span><span class=p>(</span><span class=n>EventThread</span><span class=p>));</span><span class=w></span>
<span class=w> </span><span class=n>EventThreadStart</span><span class=w> </span><span class=n>evt</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=n>SNotifyCenter</span><span class=o>::</span><span class=n>getSingleton</span><span class=p>().</span><span class=n>FireEventSync</span><span class=p>(</span><span class=o>&amp;</span><span class=n>evt</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=n>BeginThread</span><span class=p>();</span><span class=w> </span>
<span class=p>}</span><span class=w></span>
<span class=kt>void</span><span class=w> </span><span class=nf>CMainDlg::OnBtnStopNotifyThread</span><span class=p>()</span><span class=w></span>
<span class=p>{</span><span class=w></span>
<span class=w> </span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>IsRunning</span><span class=p>())</span><span class=w> </span><span class=k>return</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=n>EndThread</span><span class=p>();</span><span class=w></span>
<span class=w> </span><span class=n>EventThreadStop</span><span class=w> </span><span class=n>evt</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=n>SNotifyCenter</span><span class=o>::</span><span class=n>getSingleton</span><span class=p>().</span><span class=n>FireEventSync</span><span class=p>(</span><span class=o>&amp;</span><span class=n>evt</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=n>SNotifyCenter</span><span class=o>::</span><span class=n>getSingleton</span><span class=p>().</span><span class=n>removeEvent</span><span class=p>(</span><span class=n>EventThreadStart</span><span class=o>::</span><span class=n>EventID</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=n>SNotifyCenter</span><span class=o>::</span><span class=n>getSingleton</span><span class=p>().</span><span class=n>removeEvent</span><span class=p>(</span><span class=n>EventThreadStop</span><span class=o>::</span><span class=n>EventID</span><span class=p>);</span><span class=w></span>
<span class=w> </span><span class=n>SNotifyCenter</span><span class=o>::</span><span class=n>getSingleton</span><span class=p>().</span><span class=n>removeEvent</span><span class=p>(</span><span class=n>EventThread</span><span class=o>::</span><span class=n>EventID</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <p>3、使需要处理通知中心分发的事件的对象从 TAutoEventMapReg 继承，实现事件的自 动订阅（方便在事件映射表中统一处理事件)，这一步是可选的，你也可以直接使用 SOUI 提供的事件订阅机制向通知中心订阅特定事件。 4、在事件映射表里处理事件（没有第 3 步时，则同样没有这一步）。 具体用法参见 SOUI 的 demo。</p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../21/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 4.21 在 SOUI 中做事件分发处理" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 上一页 </span> 4.21 在 SOUI 中做事件分发处理 </div> </div> </a> <a href=../23/ class="md-footer__link md-footer__link--next" aria-label="下一页: 4.23 在 SOUI2.0 中像 android 一样使用资源" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 下一页 </span> 4.23 在 SOUI2.0 中像 android 一样使用资源 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2010 - 2021 SoUI Team </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "search.suggest", "search.highlight", "search.share"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "search": "../../assets/javascripts/workers/search.0bbba5b5.min.js"}</script> <script src=../../assets/javascripts/bundle.e1a181d9.min.js></script> <script src=https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js></script> <script src=../../static/js/extra.js></script> <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>