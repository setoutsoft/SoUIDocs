<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="C++ 快速设计界面库"><meta name=author content="SoUI Team"><link href=https://X.org/Overview/10/ rel=canonical><link href=../../Show/show/ rel=prev><link href=../11/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.26"><title>前言 - SoUI 官方文档</title><link rel=stylesheet href=../../assets/stylesheets/main.6543a935.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Noto Sans";--md-code-font:"Source Code Pro"}</style><link rel=stylesheet href=../../static/css/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=preference data-md-color-primary=white data-md-color-accent=blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../.. title="SoUI 官方文档" class="md-header__button md-logo" aria-label="SoUI 官方文档" data-md-component=logo> <img src=../../static/img/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> SoUI 官方文档 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 前言 </span> </div> </div> </div> <div class=md-header__option> <div class=md-select> <button class="md-header__button md-icon" aria-label=选择当前语言> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=/ hreflang class=md-select__link> 中文 </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/2926295173/SoUIDocs title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> 2926295173/SoUIDocs </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Start </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> 概述 </a> </li> <li class=md-tabs__item> <a href=../../BuildSoUI/build/ class=md-tabs__link> 编译 </a> </li> <li class=md-tabs__item> <a href=../../Create/31/ class=md-tabs__link> 创建 </a> </li> <li class=md-tabs__item> <a href=../../Development/0/ class=md-tabs__link> 开发 </a> </li> <li class=md-tabs__item> <a href=../../Control/Summary/ class=md-tabs__link> 控件 </a> </li> <li class=md-tabs__item> <a href=../../Ask/Summary/ class=md-tabs__link> 提问 </a> </li> <li class=md-tabs__item> <a href=../../Others/1/ class=md-tabs__link> 其他 </a> </li> <li class=md-tabs__item> <a href=../../updatelog/ class=md-tabs__link> 更新 </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="SoUI 官方文档" class="md-nav__button md-logo" aria-label="SoUI 官方文档" data-md-component=logo> <img src=../../static/img/logo.png alt=logo> </a> SoUI 官方文档 </label> <div class=md-nav__source> <a href=https://github.com/2926295173/SoUIDocs title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> 2926295173/SoUIDocs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Start </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Start </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> 引言 </span> </a> </li> <li class=md-nav__item> <a href=../../discussion/ class=md-nav__link> <span class=md-ellipsis> 讨论交流与问题反馈 </span> </a> </li> <li class=md-nav__item> <a href=../../theme/ class=md-nav__link> <span class=md-ellipsis> 网站主题配色 </span> </a> </li> <li class=md-nav__item> <a href=../../Show/show/ class=md-nav__link> <span class=md-ellipsis> 效果展示墙 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> 概述 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 概述 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 前言 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 前言 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#ui-soui class=md-nav__link> <span class=md-ellipsis> 谈谈 UI 神器-SOUI </span> </a> </li> <li class=md-nav__item> <a href=#soui class=md-nav__link> <span class=md-ellipsis> SOUI 是什么？ </span> </a> </li> <li class=md-nav__item> <a href=#soui_1 class=md-nav__link> <span class=md-ellipsis> SOUI 代码的获取 </span> </a> <nav class=md-nav aria-label="SOUI 代码的获取"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#soui-2 class=md-nav__link> <span class=md-ellipsis> SoUI 2 </span> </a> </li> <li class=md-nav__item> <a href=#soui-3 class=md-nav__link> <span class=md-ellipsis> SoUI 3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#soui_2 class=md-nav__link> <span class=md-ellipsis> SOUI 界面效果 </span> </a> </li> <li class=md-nav__item> <a href=#soui_3 class=md-nav__link> <span class=md-ellipsis> SOUI 的特点 </span> </a> </li> <li class=md-nav__item> <a href=#soui_4 class=md-nav__link> <span class=md-ellipsis> SOUI 亮点 </span> </a> <nav class=md-nav aria-label="SOUI 亮点"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 界面布局 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 渲染流程 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 分层窗口 </span> </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 非客户区 </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 资源加载 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 窗口动画改进 </span> </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 容器分层 </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 高性能列表控件 </span> </a> </li> <li class=md-nav__item> <a href=#richedit class=md-nav__link> <span class=md-ellipsis> 无窗口 Richedit </span> </a> </li> <li class=md-nav__item> <a href=#xmllua class=md-nav__link> <span class=md-ellipsis> XML+LUA </span> </a> <nav class=md-nav aria-label=XML+LUA> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 实现方法 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 多语言翻译 </span> </a> <nav class=md-nav aria-label=多语言翻译> <ul class=md-nav__list> <li class=md-nav__item> <a href=#string class=md-nav__link> <span class=md-ellipsis> String 及其它基于模板的集合对象的参数传递 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 先进的事件处理模型 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 结束语 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../11/ class=md-nav__link> <span class=md-ellipsis> 1.1 SOUI 是什么？ </span> </a> </li> <li class=md-nav__item> <a href=../12/ class=md-nav__link> <span class=md-ellipsis> 1.2 SOUI 相对于 DuiEngine 的改进 </span> </a> </li> <li class=md-nav__item> <a href=../13/ class=md-nav__link> <span class=md-ellipsis> 1.3 SOUI 模块结构 </span> </a> </li> <li class=md-nav__item> <a href=../14/ class=md-nav__link> <span class=md-ellipsis> 1.4 模块结构图及框架图 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> 编译 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 编译 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../BuildSoUI/build/ class=md-nav__link> <span class=md-ellipsis> 2、SOUI 的编译 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> 创建 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 创建 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Create/31/ class=md-nav__link> <span class=md-ellipsis> 3.1 创建 SOUI 项目（手工创建） </span> </a> </li> <li class=md-nav__item> <a href=../../Create/32/ class=md-nav__link> <span class=md-ellipsis> 3.2 创建 SOUI 项目（通过向导创建） </span> </a> </li> <li class=md-nav__item> <a href=../../Create/33/ class=md-nav__link> <span class=md-ellipsis> 3.3 布局可视化设计 </span> </a> </li> <li class=md-nav__item> <a href=../../Create/34/ class=md-nav__link> <span class=md-ellipsis> 3.4 使用 uiresImporter 生成 uires.idx 及 skin.xml </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> 开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Development/0/ class=md-nav__link> <span class=md-ellipsis> 4、SOUI 开发说明 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/1/ class=md-nav__link> <span class=md-ellipsis> 4.1 xml 资源文件定义 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/2/ class=md-nav__link> <span class=md-ellipsis> 4.2 系统资源管理 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/3/ class=md-nav__link> <span class=md-ellipsis> 4.3 应用程序中资源的组织 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/4/ class=md-nav__link> <span class=md-ellipsis> 4.4 在 SOUI 中用九宫格拉伸方式显示一个图片资源 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/7/ class=md-nav__link> <span class=md-ellipsis> 4.7 在 SOUI 中使用有窗口句柄的子窗口 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/8/ class=md-nav__link> <span class=md-ellipsis> 4.8 SOUI 中控件事件的响应 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/9/ class=md-nav__link> <span class=md-ellipsis> 4.9 SOUI 多语言翻译机制 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/10/ class=md-nav__link> <span class=md-ellipsis> 4.10 自定义控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/11/ class=md-nav__link> <span class=md-ellipsis> 4.11 在 SOUI 中使用定时器 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/12/ class=md-nav__link> <span class=md-ellipsis> 4.12 在 SOUI 中消息通讯 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/13/ class=md-nav__link> <span class=md-ellipsis> 4.13 使用窗口的 cache 属性加速 SOUI 的渲染 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/14/ class=md-nav__link> <span class=md-ellipsis> 4.14 在 SOUI 中实现 PreTranslateMessage </span> </a> </li> <li class=md-nav__item> <a href=../../Development/15/ class=md-nav__link> <span class=md-ellipsis> 4.15 提高 SOUI 应用程序渲染性能的三种武器 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/16/ class=md-nav__link> <span class=md-ellipsis> 4.16 在 SOUI 中使用分层窗口 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/17/ class=md-nav__link> <span class=md-ellipsis> 4.17 在 SOUI 中的控件注册机制 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/18/ class=md-nav__link> <span class=md-ellipsis> 4.18 在 SOUI 中使用代码向窗口中插入子窗口 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/19/ class=md-nav__link> <span class=md-ellipsis> 4.19 在 SOUI 中使用 LUA 脚本开发界面 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/20/ class=md-nav__link> <span class=md-ellipsis> 4.20 导出 SOUI 对象到 LUA 脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/21/ class=md-nav__link> <span class=md-ellipsis> 4.21 在 SOUI 中做事件分发处理 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/22/ class=md-nav__link> <span class=md-ellipsis> 4.22 在 SOUI 中使用异步通知 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/23/ class=md-nav__link> <span class=md-ellipsis> 4.23 在 SOUI2.0 中像 android 一样使用资源 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/24/ class=md-nav__link> <span class=md-ellipsis> 4.24 两个 SOUI 新控件 ---- SListView 和 SComboView（借用 Andorid 的设计） </span> </a> </li> <li class=md-nav__item> <a href=../../Development/25/ class=md-nav__link> <span class=md-ellipsis> 4.25 在 SOUI 中控件属性查询方法 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/26/ class=md-nav__link> <span class=md-ellipsis> 4.26 使用 SOUI 的 SMCListView 控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Development/27/ class=md-nav__link> <span class=md-ellipsis> 4.27 SLogViewer下载及使用说明 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> 控件 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 控件 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Control/Summary/ class=md-nav__link> <span class=md-ellipsis> 5、控件说明（SOUI） </span> </a> </li> <li class=md-nav__item> <a href=../../Control/51/ class=md-nav__link> <span class=md-ellipsis> 5.1 SWindow 类 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/52/ class=md-nav__link> <span class=md-ellipsis> 5.2 SwndStyle 类 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/53/ class=md-nav__link> <span class=md-ellipsis> 5.3 SHostWndAttr 类 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/54/ class=md-nav__link> <span class=md-ellipsis> 5.4 静态文本控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/55/ class=md-nav__link> <span class=md-ellipsis> 5.5 超链接控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/56/ class=md-nav__link> <span class=md-ellipsis> 5.6 按钮/图片按钮控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/57/ class=md-nav__link> <span class=md-ellipsis> 5.7 图片控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/58/ class=md-nav__link> <span class=md-ellipsis> 5.8 动画图片窗口控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/59/ class=md-nav__link> <span class=md-ellipsis> 5.9 线条控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/510/ class=md-nav__link> <span class=md-ellipsis> 5.10 复选框控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/511/ class=md-nav__link> <span class=md-ellipsis> 5.11 图标控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/512/ class=md-nav__link> <span class=md-ellipsis> 5.12 单选框控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/513/ class=md-nav__link> <span class=md-ellipsis> 5.13 Toggle 控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/514/ class=md-nav__link> <span class=md-ellipsis> 5.14 组控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/515/ class=md-nav__link> <span class=md-ellipsis> 5.15 可输入 CommboBox 控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/516/ class=md-nav__link> <span class=md-ellipsis> 5.16 日历控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/517/ class=md-nav__link> <span class=md-ellipsis> 5.17 标签控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/518/ class=md-nav__link> <span class=md-ellipsis> 5.18 富文本编辑框控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/519/ class=md-nav__link> <span class=md-ellipsis> 5.19 简单 edit 控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/520/ class=md-nav__link> <span class=md-ellipsis> 5.20 表头控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/521/ class=md-nav__link> <span class=md-ellipsis> 5.21 热键控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/522/ class=md-nav__link> <span class=md-ellipsis> 5.22 列表框控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/523/ class=md-nav__link> <span class=md-ellipsis> 5.23 列表控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/524/ class=md-nav__link> <span class=md-ellipsis> 5.24 滚动条控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/525/ class=md-nav__link> <span class=md-ellipsis> 5.25 滑块工具条控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/526/ class=md-nav__link> <span class=md-ellipsis> 5.26 分割窗口控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/527/ class=md-nav__link> <span class=md-ellipsis> 5.27 分割窗口控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/528/ class=md-nav__link> <span class=md-ellipsis> 5.28 Tab 标签页面控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/529/ class=md-nav__link> <span class=md-ellipsis> 5.29 Tab 控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/530/ class=md-nav__link> <span class=md-ellipsis> 5.30 树控件 </span> </a> </li> <li class=md-nav__item> <a href=../../Control/531/ class=md-nav__link> <span class=md-ellipsis> 5.31 按钮控件 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> 提问 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> 提问 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Ask/Summary/ class=md-nav__link> <span class=md-ellipsis> 6、常见问题 </span> </a> </li> <li class=md-nav__item> <a href=../../Ask/1/ class=md-nav__link> <span class=md-ellipsis> 6.1 模块 utilities 为什么要用 DLL 编译？ </span> </a> </li> <li class=md-nav__item> <a href=../../Ask/2/ class=md-nav__link> <span class=md-ellipsis> 6.2 为什么在 soui 中加载 JPG 文件失败？ </span> </a> </li> <li class=md-nav__item> <a href=../../Ask/3/ class=md-nav__link> <span class=md-ellipsis> 6.3 不注册 COM 在 Richedit 中使 OLE 支持复制粘贴 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Others/1/ class=md-nav__link> <span class=md-ellipsis> 7.1 谈谈 SOUI 与 WTL </span> </a> </li> <li class=md-nav__item> <a href=../../Others/2/ class=md-nav__link> <span class=md-ellipsis> 7.2 在 SOUI 中非半透明窗口如何实现圆角窗口？ </span> </a> </li> <li class=md-nav__item> <a href=../../Others/3/ class=md-nav__link> <span class=md-ellipsis> 7.4 一种高效的可变行高列表行定位算法 </span> </a> </li> <li class=md-nav__item> <a href=../../Others/4/ class=md-nav__link> <span class=md-ellipsis> 一种快速刷新richedit中内嵌动画的方法的实现 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> 更新 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> 更新 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../updatelog/ class=md-nav__link> <span class=md-ellipsis> SoUI 版本更新日志 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#ui-soui class=md-nav__link> <span class=md-ellipsis> 谈谈 UI 神器-SOUI </span> </a> </li> <li class=md-nav__item> <a href=#soui class=md-nav__link> <span class=md-ellipsis> SOUI 是什么？ </span> </a> </li> <li class=md-nav__item> <a href=#soui_1 class=md-nav__link> <span class=md-ellipsis> SOUI 代码的获取 </span> </a> <nav class=md-nav aria-label="SOUI 代码的获取"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#soui-2 class=md-nav__link> <span class=md-ellipsis> SoUI 2 </span> </a> </li> <li class=md-nav__item> <a href=#soui-3 class=md-nav__link> <span class=md-ellipsis> SoUI 3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#soui_2 class=md-nav__link> <span class=md-ellipsis> SOUI 界面效果 </span> </a> </li> <li class=md-nav__item> <a href=#soui_3 class=md-nav__link> <span class=md-ellipsis> SOUI 的特点 </span> </a> </li> <li class=md-nav__item> <a href=#soui_4 class=md-nav__link> <span class=md-ellipsis> SOUI 亮点 </span> </a> <nav class=md-nav aria-label="SOUI 亮点"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 界面布局 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 渲染流程 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 分层窗口 </span> </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 非客户区 </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 资源加载 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 窗口动画改进 </span> </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 容器分层 </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 高性能列表控件 </span> </a> </li> <li class=md-nav__item> <a href=#richedit class=md-nav__link> <span class=md-ellipsis> 无窗口 Richedit </span> </a> </li> <li class=md-nav__item> <a href=#xmllua class=md-nav__link> <span class=md-ellipsis> XML+LUA </span> </a> <nav class=md-nav aria-label=XML+LUA> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 实现方法 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 多语言翻译 </span> </a> <nav class=md-nav aria-label=多语言翻译> <ul class=md-nav__list> <li class=md-nav__item> <a href=#string class=md-nav__link> <span class=md-ellipsis> String 及其它基于模板的集合对象的参数传递 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 先进的事件处理模型 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 结束语 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=_1>前言<a class=headerlink href=#_1 title="Permanent link">&para;</a></h1> <h2 id=ui-soui>谈谈 UI 神器-SOUI<a class=headerlink href=#ui-soui title="Permanent link">&para;</a></h2> <p>在 Windows 平台上开发客户端产品是一个非常痛苦的过程，特别是还要用 C++的时候。</p> <p>尽管很多语言很多方法都可以开发 Windows 桌面程序，目前国内流行的客户端产品都是 C++开发的，比如 QQ，迅雷等。</p> <p>快速，稳定是我认为的应用软件开发框架最基本的要求，对于 UI 还有两个要求就是界面美观，配置灵活。</p> <p>C++语言满足了快速的要求，传统的客户端软件开发框架如 MFC（微软在更新），WTL（微软早已不再更新） 等满足了稳定的要求。然而界面美观，配置灵活是 MFC，WTL 这样的开发框架所不能满足的。</p> <p>腾讯是做客户端发家的，他们的 UI 经验积累非常好，有自己专门的 UI 框架； 迅雷有一个专业的团队开发自己的 UI 框架；</p> <p>然而大多数公司只希望有一个能够快速完成项目开发的 UI 库来使用，它们没有专业的团队来维护 UI 库。 国企有钱任性，所以成就了 UIPower： 一个商业化的 DirectUI 库（具体怎么样不好说，优点在于有人给你服务），一般的小公 司没有谁愿意当这个冤大头。 这就是 Duilib 这样一个简单到简陋的 UI 库（请原谅我这样说）为什么这样流行的原因（百度一下 Duilib 就知道它有多少人在用）。</p> <p>Duilib 基本满足了界面美观 ，配置灵活的需求，然而由于框架本身的限制，要实现复杂的 效果将不可避免的遇到各种坑。 好在 Duilib 代码量很少，随便一个有经验的 UI 开发工程 师都能够相对容易的使用并修改它，所以在一般的应用中使用并不会有太大的问题，这也 应该是为什么会有那么多的 Duilib 变种的原因：每一个使用它的公司或者个人都会有一份 独一无二的副本。</p> <p>其实上面我还漏了说 QT， QT 在国外有专业的团队维护，文档也很好，但至少有两个缺 点： 1、它是跨平台的，跨平台即是优点，也是缺点，为了实现跨平台，很多时候需要做 出取舍，就算抽象的 100％的完美，它也不可避免的带来体积庞大； 2、代码量太大，普通人很难驾驭：就算是看懂都不容易，更别说修改了，这样的结果就是一旦在使用中遇到 问题你唯一的选择就是提交 BUG 给 QT 开发小组等待补丁（要知道不存在没有 BUG 的产 品）。</p> <h2 id=soui>SOUI 是什么？<a class=headerlink href=#soui title="Permanent link">&para;</a></h2> <p>SOUI 是一套和 Duilib 类似的开源 C++ UI 开发框架。 它的前身是金山卫士开源版本中使用的 UI 库 Bkwin，之后由启程软件（也就是我了）开发维护升级为 Duiengine，最后 历经多次重构改名为 SOUI，寓意“瘦 UI”，“UI, just so so!”。 使用 MIT 开源协议（SOUI3采用自定义开源协议），公司、个人兼可免费作用，只需要发布时带上 SOUI 的 license。</p> <h2 id=soui_1>SOUI 代码的获取<a class=headerlink href=#soui_1 title="Permanent link">&para;</a></h2> <p>SoUI采用GIT进行代码版本管理， 目前由github上的作为开发仓库 由gitee上的作为镜像仓库</p> <h3 id=soui-2>SoUI 2<a class=headerlink href=#soui-2 title="Permanent link">&para;</a></h3> <p>GIT：<a href=https://github.com/setoutsoft/soui>https://github.com/setoutsoft/soui</a></p> <h3 id=soui-3>SoUI 3<a class=headerlink href=#soui-3 title="Permanent link">&para;</a></h3> <p>GITHUB:<a href=https://github.com/soui3/soui>https://github.com/soui3/soui</a> 码云：<a href=https://gitee.com/setoutsoft/soui3>https://gitee.com/setoutsoft/soui3</a></p> <h2 id=soui_2>SOUI 界面效果<a class=headerlink href=#soui_2 title="Permanent link">&para;</a></h2> <p>此处有图片</p> <h2 id=soui_3>SOUI 的特点<a class=headerlink href=#soui_3 title="Permanent link">&para;</a></h2> <p>使用层：高速，稳定，美观，可配置</p> <p>代码层：精心设计，模块低耦合，插件化设计，对象可靠的命令周期管理，类似 WTL 的编码方式，现代化的事件处理模型及优异的扩展能力。</p> <p>代码量：核心模块代码量 4W+，编译后 DLL Release 版本在 900K 左右。</p> <p>得益于精心组织的代码框架，虽然代码量较 Duilib 这样的 UI 库有比较大的提高（核心框架更完善，控 件更多，注释量更大），但是阅读代码还是很轻松的（大量实际用户的亲身体验）。</p> <p>高速主要体现在 3 个方面：</p> <p>1、框架设计扁平化，层次简单（和 QT 相比）： 从宿主窗口收到消息到控件响应消息只有一个中间层。</p> <p>2、简单有效的刷新策略： 通过对剪裁区及刷新时机的有较控制， 能有效的提高刷新效率。</p> <p>3、高效的渲染引擎： 通过 将渲染引擎接口化，成功的将 skia 渲染引擎引入到 SOUI中。 Skia 是 Google 的 Chrome，Futter,Android 的渲染引擎， 在Chrome中的渲染速度 比 IE 渲染快，Skia 功不可没。</p> <p>稳定性方面； SOUI 脱胎于 Bkwin，再经过本人的不断精心重构，已经在多个大量用户的 产品中应用，包括瑞雪医生客户端，多玩魔盒 2.0, Dota2 游戏盒子及多玩等多 个游戏盒子中使用， 还有百度云管家的大部分界面。</p> <p>百度云管家据说最初使用的是腾讯 QQ 界面库的早期版本（无从考证），然而 QQ 界面库 大量使用 COM 技术，扩展非常麻烦，使用很是不便，在后续的 UI 需求中开始大量使用 SOUI 的前身 DuiEngine。</p> <p>美观方面； SOUI 原生支持 Alpha 通道，能够实现各种半透明效果，包括主窗体半透明， DUI 窗口半透明，DUI 窗口模仿 LayeredWindow（分层窗口）效果等，轻松实现各种异 形效果。</p> <p>配置方面： SOUI 中所有 UI 资源都采用 XML 描述，调整 UI 效果一般只需要修改 XML资源即可完成。 说到代码层的设计很难用语言描述，只有亲自阅读代码方能理解。 为大部分需要在外部（APP 层）经常引用的 UI 相关对象提供引用计数设计能够有效减少 C++开发中常见的野 指针问题，这一点还是很好体会， 同时系统中也重点解决了如消息分发的分层设计， 窗口对象的消息重入等影响 UI 使用体验的关键性问题。</p> <h2 id=soui_4>SOUI 亮点<a class=headerlink href=#soui_4 title="Permanent link">&para;</a></h2> <p>宽泛的说 SOUI 多好大家并没有直观的感觉，下面从一些具体的点来介绍 SOUI。</p> <h3 id=_2>界面布局<a class=headerlink href=#_2 title="Permanent link">&para;</a></h3> <p>也许初学者对于 SOUI 的布局还不太适应，特别是对于那些习惯了 Duilib 的布局方式的朋友。 事实上 SOUI 的布局应该是最接近程序思维的布局方式。 前段时间开发 Android，仅仅是它的 5 大 Layout 就能让人崩溃，而且不同的 layout 对应的布局属性还不一样。 SOUI 的布局非常简单，只有两个布局属性：pos + offset，具体参考博客：</p> <p><a href=http://www.cnblogs.com/setoutsoft/p/3925952.html>http://www.cnblogs.com/setoutsoft/p/3925952.html</a></p> <p>通常使用一个 pos 属性就解决布局问题了， pos 在 XML 中使用"x1,y1,x2,y2"这样的 4个坐标定义一个控件在父窗口中的相对位置， 而 offset 则定义通过 pos 计算出来的位置后在 X，Y 两个方向需要叠加的偏移， 偏移值需要乘上窗口大小。</p> <p>例如下面这个需求：</p> <p>此处有图片</p> <p>只知道窗口需要靠右下角，不知道窗口大小的情况， 在 SOUI 中只需要使用属性 pos=“-20,-30” offset="-1,-1"即可。</p> <h3 id=_3>渲染流程<a class=headerlink href=#_3 title="Permanent link">&para;</a></h3> <p>一个 UI 中的界面元素最后会通过各级子窗口形成一个树状结构。</p> <p>一般的渲染流程自然是从根节点一层一层的直到渲染完成所有叶结点。</p> <p>这个过程很简单，可能很多 UI 库也就做到这个层次（例如 DuiLib）。</p> <p>但是对于一个高性能的 UI 库仅做到这个层次是不够的，举例来说：</p> <p>一个画笔程序需要在 OnMouseMove 里面绘制新拾取的线条，</p> <p>本能的做法是获取窗口画布，绘制完成后再提交画布（类似 Windows API: GetDC and ReleaseDC），</p> <p>而不是每一次绘制只能请求宿主刷新（请求宿主立即刷新依赖于系统对 UpdateWindow 这个 API 的响应速度）。</p> <p>因此一个成熟的 UI 引擎有必要实现 GetDC 及 ReleaseDC 这样的接口。</p> <p>和基于 HWND的窗口获取 HDC 不同，</p> <p>在一套 DirectUI 系统中实现 GetDC 及 ReleaseDC 要更加复杂：</p> <p>最关键的问题在于获取前绘制窗口的背景，以及提交后绘制窗口的前景，要实现窗口 背景前景的分开绘制又需要系统提供绘制在指定 Z-Order 范围内的窗口的能力，当然前提 是系统中有 Z-Order 这样的概念。</p> <p>就算实现了窗口的背景与前景的分别绘制，对于一个高性能的 UI 引擎可能还是不够的。</p> <p>因为有些时候一个窗口中的内容是不需要和背景混合的，窗口刷新的时候绘制背景是没有 意义的（如视频播放窗口），就是需要另一种技术：</p> <p>窗口的跨层渲染（不知道这样命名是不是合适）。</p> <p>当一个视频窗口需要刷新的时候，它的刷新流程和基本的刷新流程是不一样的， 渲染时它会跳过它的所有父窗口直接到这个窗口层来，从而大大加速渲染过程。</p> <h3 id=_4>分层窗口<a class=headerlink href=#_4 title="Permanent link">&para;</a></h3> <p>Windows 的分层窗口是 Windows 2000 提供的一项重要更新。</p> <p>苹果系统的 UI 很漂亮，有了分层窗口，Windows 系统上开发的应用也可以同样漂亮。</p> <p>这里说的分层窗口有两个层次：</p> <p>一个是 DirectUI 的宿主窗口中使用分层窗口技术；</p> <p>另一层是在 DirectUI 的 DUI 窗口系统内部实现分层窗口技术。</p> <p>使用分层窗口技术听起来比较简单，不就是设计一个 WS_EX_LAYEREDWINDOW 属性 再使用 UpdateLayeredWindow(EX)更新窗口吗？！</p> <p>如果 SOUI 只达到这个层次，那和codeproject 上随便找一个 demo 也没有什么区别。</p> <p>首先要搞清楚，SOUI 是一套 DirectUI 系统，而不是 Demo，因此它不能停留在加载一 个 32 位 PNG 图片并显示出来这样的层次上。</p> <p>它必须要能够让用户能够调用各种绘制图形，</p> <p>图像，文字的 API 来组合出一个最终需要呈现的 32 位位图。</p> <p>这一点要求看起来简单，在 Windows 系统上实现起来并不简单， 因为 Windows 上最基本的绘制 API（GDI）都是不支持 alpha 通道的。</p> <p>有一个简单的选择：</p> <p>GDIPlus。</p> <p>然而 GDIPlus 有一个毛病就是速度太慢，这对于一个通用的 UI 引擎来说， 全部依赖 GDIPlus 基本上就宣判了这个引擎的死刑。</p> <p>在 SOUI 中采用渲染引擎抽象的方法实现了两种渲染引擎：</p> <p>Skia +GDI。</p> <p>前面不是说 GDI 不支持 Alpha 通道，所以不能用吗？</p> <p>没错，直接用 GDI 函数是不行的，我们需要适当的改造（具体方法参见代码）。</p> <p>解决了绘制方法，要更新到窗口中显示也还是有技巧的。 有人可能知道，使用UpdateLayeredWindow 这个 API 更新的窗口将收不到 WM_PAINT 消息。 由于在半透明窗口中不能直接支持有窗口句柄的子窗口的显示（如 IE 控件）， SOUI 还必须为那些需要容纳窗口句柄子窗口的情况提供支持， 即通过配置同时支持半透明窗口与不透明窗口。 但是我不愿意为两种不同的最终位图呈现模型提供两套不同的机制。 解决的办法很简单，通过为半透明类型的窗口设计一个辅助窗口， 使用它来接收 WM_PAINT 消息，收到该消息时调用 UpdateLayeredWindow 更新窗口。 注： 这个技术是学习另一套 UI 库 MetalBone 实现的。</p> <p>讲完了使用宿主窗口分层窗口，下面讲讲 DUI 窗口的分层窗口技术的实现。 使用分层窗口技术能够使 UI 效果更漂亮，关键技术就在这个层。 层是什么？层是一组窗口的绘制容器，它将该层下所有子窗口的绘制内容绘制到一个独立的缓冲区上， 最后再一 起绘制到分层窗口的上一层绘制缓冲区中。 如下图：</p> <p>此处有图片</p> <p>A、B、B1、B2、C 为 DUI 系统中 5 个 DUI 窗口。 其中，B、B1、B2 是同一个渲染层。 也就是说设计需要它们先绘制好后再和 A，C 做融合。 类似的需求对于一个漂亮的 UI 来说可能会很常见。 如果在 UI 引擎中没有层的概念是不可能实现的。 如果不需要实现前面提到的背景和前景分别渲染的情况， 实现会层窗口其实也不难，只需要在渲染到 B 窗口时 创建一个缓冲区，把从 B 开始的内容渲染到这个缓冲区， 完成后再回到正常渲染流程，就像没有 B1、B2 一样。 但是 SOUI 是支持背景前景分别渲染的，实现这个过程的代码逻辑 就可能很复杂了（可以自己想象一下）。</p> <h3 id=_5>非客户区<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <p>HWND 的非客户区用来绘制滚动条及边框及标题栏，菜单栏。 客户区是用户绘制的常规区域，在设计上将窗口的显示区域划分为客户区和非客户区， 有利于用户在重写客户区的绘制代码时不被非客户区干扰，也有利于代码的复用。</p> <p>在 DuiLib 中，一个控件如 Richedit 需要显示滚动条，它需要给这个控件组合两个滚动条控件。 这种方式虽然看上去没有什么大的问题， 如果由于窗口中内容的变化需要动态显示隐藏滚动条时可能会很麻烦， 至少它会引起窗口布局系统的重排，因为滚动条显示和隐藏时控件的客户区大小是变化的。</p> <p>而在 SOUI 系统中，滚动条和 HWND 一样，用户根本不需要关心， 因为内部已经自动处理好了滚动条，也不会引起布局系统的重排。</p> <h3 id=_6>资源加载<a class=headerlink href=#_6 title="Permanent link">&para;</a></h3> <p>一般来说 SOUI 中引用的所有资源都在 XML 中描述。</p> <p>刚入门的朋友通常反映 SOUI 中使用资源的方式不如 DuiLib 直接，很难入门。</p> <p>但是一旦真正理解了 SOUI 的这种资源组织方式一定会更喜欢 SOUI。</p> <p>SOUI 提供 3 种资源加载方式：文件，PE 资源，ZIP 包。</p> <p>首先 SOUI 的资源包必须提供一个文件索引表，对于使用 PE 资源的资源包， 索引表就是资源的类型及 ID，而对于直接使用文件或者 ZIP 包的资源， 索引表则是一个 XML 文件。</p> <p>在索引表中，定义每一个资源的 type 及 name 两个 KEY， SOUI 界面布局中只能使用type 和 name 两个 key 来引用资源。</p> <p>用户只需要准备一套文件资源，如果需要将资源编译到 PE 文件中，系统提供一个工具直 接从文件资源的索引 XML 转换成 rc 编译器可以识别的 rc 文件； 而如果用户需要使用 ZIP资源包，则只需要使用一个 ZIP 工具如 rar, 7z 将资源文件夹打包即可 （推荐使用 7z 打包资源，SOUI 内自带的 zlib 1.2.5 能够识别 7z 打包的带密码的 zip 包，但不能识别 rar 打包的带密码的 zip 包。）</p> <h3 id=_7>窗口动画改进<a class=headerlink href=#_7 title="Permanent link">&para;</a></h3> <p>一般情况下我们推荐使用窗口定时器来创建动画。</p> <p>使用窗口定时器创建动画的好处是定时器和 UI 是同一个线程， 而 SOUI 不支持多线程同步更新 UI（事实上一般的 DirectUI 库 都不推荐在工作线程中操作 UI，如 Android）。 那么问题来了，如果为每一个 DUI 窗口创建很多定时器， 那么系统的消息队列中将充满定时器消息，严重时可能大大降低 UI 性能。 解决方案：在主窗口中创建一个 10ms 间隔的定时器，需要处理动画的窗口向系统注册使 用该定时器，动画记录下一次动画需要等待的时间，使用该统一的定时器计数。</p> <p>我们看一下面 DEMO 中显示大量动画表情时 SOUI 的效率： 此处有图片 这一 CPU 占用率甚至比 QQ 中同样情况下还低。</p> <h3 id=_8>容器分层<a class=headerlink href=#_8 title="Permanent link">&para;</a></h3> <p>什么叫容器分层？ 在 DirectUI 中所有的 DUI 窗口都必须生存在一个容器中。 DUI 窗口的绘制请求等最终需要由这个容器来实现。 在容器不分层的情况下，所有 DUI 窗口在容器中的物理坐标都是从(0,0)开始。</p> <p>这样有什么问题呢？ 如果要在列表控件的列表项中使用DUI 控件就会变得非常麻烦， 因为在窗口滚动时你可能不得不同时更新所有这些控件的坐标。 有了窗口层的概念就不一样了，每珍上列表项是一个新的容器， 无论列表项显示在哪，列表项中的控件（容器中的控件）的坐标都不需要调整。</p> <p>因为有了容器分层，在 SOUI 中实现包含子控件的列表变得非常简单 （参考下节：高性能列表控件）。</p> <h3 id=_9>高性能列表控件<a class=headerlink href=#_9 title="Permanent link">&para;</a></h3> <p>Windows 系统中提供的列表控件非常简单，只能满足简单的数据显示需求。 注意，是显示。 然而现在的 UI 需求中经常出现那种即时修改列表控件内容的情况， 你将不得不花大量的时间对列表控件进行自绘，而效果只能说勉强。</p> <p>通过研究 Android 系统中提供的列表控件的代码， 借鉴 Android 中 ListView 的思想， SOUI 实现了一套高性能的列表控件 SListView 及 SMcListView。</p> <p>SListView 及 SMcListView 都是基于虚表技术， 同时只创建当前正在显示的及部分备用的列表项容器，将资源占用缩小到最少。</p> <p>同时 ListView 在滚动时能够高效刷新，实现了海量数据的高性能显示及更新。</p> <p>实现这个高性能列表控件的关键有两点：</p> <p>首先是 SOUI 中实现的容器层的概念，使得列表位位置变化时，容器内部的控件不需要调整坐标。</p> <p>其次就是容器数据的充分重用。</p> <p>此处有图片</p> <p>注：上面列表中只测试了 7W 行数据，实际上 listview 中显示的数据量多少完全不影响 UI 性能，亲测 700W 行数据和 7W 行效果一样。</p> <h3 id=richedit>无窗口 Richedit<a class=headerlink href=#richedit title="Permanent link">&para;</a></h3> <p>Edit 控件是 UI 中最常用的控件之一。 在允许存在子窗口句柄的情况下， 系统 Edit 控件已经能够很好的满足我们的需求。 然而在不允许子窗口句柄的情况下， 实现一个 Edit 控件会非常麻烦。</p> <p>当然，程序可以选择自己去重新实现一套 edit， Edit 也许还可行，一般情况下要实现一个Richedit 基本不可行。 好在实现 Richedit 的模块 riched20.dll 中把 UI 和逻辑分离开来， 即可以用它直接创建有窗口的 Richedit， 也可以用它来创建提供无窗口 Richedit 的ITextServices 接口。 然而即使是这样，程序员需要为 ITextServices 实现一个ITextHost 接口。 尽管 MSDN 上有相关的文档及示例，但是根据它们提供的这些资料实现的效果很不理想。 必竟只是 Demo，不是完整的代码，它不能演示开发中可能遇到的每一个细节。 然而恰好是这些细节是影响 UI 用户体验的关键。</p> <p>所以我们需要另辟蹊径来解决这个问题。</p> <p>解决这些细节，关键在于理解它们的逻辑。</p> <p>SOUI 的办法是找到 riched20.dll 的源代码。 好在网络上流传着一份从 WinCE 源代码中分离出来的 Riched20.dll 的源代码， 虽然用它编译出来的 Richedit 有很多 BUG，但利用它可以让我们更好的理解各种细节。 大家可以测试 SOUI 中的 Edit，效果应该是各种类似库中最好的一个之一。</p> <h3 id=xmllua>XML+LUA<a class=headerlink href=#xmllua title="Permanent link">&para;</a></h3> <p>部分模块在 SOUI 中采用了接口化设计，如前面提到的渲染引擎， 以及后面要说的多语言翻译，以及这里要说的脚本模块。 脚本语言方便灵活，更新简单，LUA 脚本还有高效的特点。 和 WEB 的 HTML+JS 类似，SOUI 实现了 XML+LUA 的 UI 开发解决方案。 XML 实现 UI 布局，LUA 实现逻辑控制。</p> <h4 id=_10>实现方法<a class=headerlink href=#_10 title="Permanent link">&para;</a></h4> <p>在 XML 中使用<code>&lt;script&gt;</code>标签声明 UI 中需要脚本支持。 通过 XML 创建 UI 时自动从脚本模块为该 UI 实例化脚本对象。 采用 lua_tinker 自动导出 C++类到 LUA 脚本空间，包含控件对象，及控件事件对象。 在 LUA 脚本中处理事件响应。</p> <h3 id=_11>多语言翻译<a class=headerlink href=#_11 title="Permanent link">&para;</a></h3> <p>多语言翻译对于需要国际化的应用来说可能非常重要。</p> <p>SOUI 通过一个语言翻译接口来执行特定上下文的多语言翻译 并且实现了一个类似 QT 语言翻译功能的基本 XML 的语言翻译模块。</p> <p>用户只需要按照 Demo 中的语言翻译文件的组织方式组织翻译 XML 就可以了。</p> <h4 id=string>String 及其它基于模板的集合对象的参数传递<a class=headerlink href=#string title="Permanent link">&para;</a></h4> <p>由于 String 通常要同时支持 char 及 wchar_t 这两种字符类型， 通常 String 在一个类库都都是以模板形式存在， 比如 WTL，ATL，（MFC 太久不用，记不清了）。</p> <p>使用模板实现的对象有一个特点，那就是代码会编译到使用它的模块中。</p> <p>如此一来，如果在这些模板类中直接调用 malloc, new 等内存分配函数时会在调用模块的堆上分配内存， 相应地，内存的翻译也需要在调用者模块中执行。</p> <p>这有什么问题呢？</p> <p>最大的问题莫过于这样的对象不宜在不同的模块之间比参数进行传递 （当然，const 参数是没问题的）。 如果一个这样的对象在 A 模块中分配的内存到 B 模块中被翻译，结果只有崩溃。 （如果所有模块采用 MD 方式动态链接 VS 的运行库是没有问题的）</p> <p>很多小软件是不希望采用 MD 编译的，因为这样的话为了确保程序的正常运行， 还需要带上 VS 中相对应的运行库，尽管体积不大，但也麻烦。</p> <p>SOUI 中采用了一点技巧，所有上述模板类都在一个独立的模块中实现， 同时改写了这些类中的内存分配及释放代码。</p> <p>将它们重位向到该模块中的两个内存分配释放方法。 经过这样处理后，不管这些模板类在哪一个模块中实例化， 它们要在堆上申请及翻译内存时都是在这个独立模块中。</p> <p>通过这个简单的技术有效的解决了这些模板对象不能在不同模块之间传递参数的问题。</p> <h3 id=_12>先进的事件处理模型<a class=headerlink href=#_12 title="Permanent link">&para;</a></h3> <p>SOUI 同时支持类似 WTL 消息映射表方式的事件映射表来响应事件， 也支持新式事件订阅的方式响应事件。 事件映射表处理事件的优点在于能够规范化的把所有事件处理方法在代码水平集中到一起， 方便代码的阅读；而事件订阅则提供了事件的动态处理能力， 能够在任意时刻灵活的响应不同控件发出的事件。</p> <h2 id=_13>结束语<a class=headerlink href=#_13 title="Permanent link">&para;</a></h2> <p>除上述亮点，我相信还有很多细节的处理都体现了 SOUI 的工匠精神， 相信用心的朋友一定可以在阅读及使用代码的过程中更深的体会到。 SOUI 是启程软件历时 5 年心血的结晶，重复一下我以前做《启程输入之星》时说的那句话： 因为努力，所以美丽！ 希望您能够喜欢。</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2010 - 2021 SoUI Team </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../assets/javascripts/bundle.ad660dcc.min.js></script> <script src=https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js></script> <script src=../../static/js/extra.js></script> <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>